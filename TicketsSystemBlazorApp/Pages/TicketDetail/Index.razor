@page "/ticketdetail"
@inject IClient Client
@inject NavigationManager Nav
@inject IJSRuntime JS

<h3 class="text-2xl font-bold mb-6 text-gray-800">📝 Ticket Detail Logs</h3>

@if (ticketDetails == null)
{
    <p class="text-gray-600">Loading ticket details...</p>
}
else if (!ticketDetails.Any())
{
    <div class="text-gray-500">No ticket details found.</div>
}
else
{
    <div class="overflow-x-auto">
        <table class="table-auto w-full border shadow-md rounded-xl bg-white">
            <thead class="bg-gray-100 text-gray-800">
                <tr>
                    <th class="px-4 py-2 text-left">Ticket ID</th>
                    <th class="px-4 py-2 text-left">User ID</th>
                    <th class="px-4 py-2 text-left">Start</th>
                    <th class="px-4 py-2 text-left">End</th>
                    <th class="px-4 py-2 text-left">Status</th>
                    <th class="px-4 py-2 text-left">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var detail in ticketDetails)
                {
                    <tr class="border-t hover:bg-gray-50">
                        <td class="px-4 py-2">@detail.TicketId</td>
                        <td class="px-4 py-2">@detail.UserId</td>
                        <td class="px-4 py-2">@detail.StartDate.ToString("yyyy-MM-dd HH:mm")</td>
                        <td class="px-4 py-2">@detail.EndDate.ToString("yyyy-MM-dd HH:mm")</td>
                        <td class="px-4 py-2">@detail.Status</td>
                        <td class="px-4 py-2 space-x-2">
                            <button class="text-blue-600 hover:underline" @onclick="@(() => Nav.NavigateTo($"/ticketdetail/details/{detail.Id}"))">View</button>
                            <button class="text-green-600 hover:underline" @onclick="@(() => Nav.NavigateTo($"/ticketdetail/update/{detail.Id}"))">Edit</button>
                            <button class="text-red-600 hover:underline" @onclick="@(() => Delete(detail.Id))">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<div class="mt-6">
    <button class="bg-blue-600 hover:bg-blue-700 text-black px-5 py-2 rounded-xl shadow" @onclick="@(() => Nav.NavigateTo("/ticketdetail/create"))">
        + Add Ticket Detail
    </button>
</div>

@code {
    private List<TicketDetailReadOnlyDto> ticketDetails;

    protected override async Task OnInitializedAsync()
    {
        ticketDetails = (await Client.TicketDetailAllAsync())?.ToList() ?? new();
    }

    private async Task Delete(int id)
    {
        var confirm = await JS.InvokeAsync<bool>("confirm", "Are you sure you want to delete this detail?");
        if (confirm)
        {
            await Client.TicketDetailDELETEAsync(id);
            ticketDetails = (await Client.TicketDetailAllAsync())?.ToList() ?? new();
        }
    }
}
